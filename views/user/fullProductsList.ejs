<!doctype html>
<html lang="zxx">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Specs-Mart</title>
  <link rel="icon" href="/img/favicon.png">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- animate CSS -->
  <link rel="stylesheet" href="/css/animate.css">
  <!-- owl carousel CSS -->
  <link rel="stylesheet" href="/css/owl.carousel.min.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="/css/all.css">
  <!-- flaticon CSS -->
  <link rel="stylesheet" href="/css/flaticon.css">
  <link rel="stylesheet" href="/css/themify-icons.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="/css/magnific-popup.css">
  <!-- swiper CSS -->
  <link rel="stylesheet" href="/css/slick.css">
  <!-- style CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">



  <style>
    /* Hide the up and down arrows */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      margin: 0;
    }

    input[type="number"] {
      -webkit-appearance: textfield;
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .logo-img {
            height: 50px;
            width: 100px;
            max-width: none;
            /* Override the max-width property */
        }
  </style>

  <!--sweetalert2 cdn-->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.4/dist/sweetalert2.all.min.js"></script>



</head>

<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>

  <!--::header part start::-->
  <header class="main_menu home_menu">
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg navbar-light">
            <!-- Navbar code... -->
            <a class="navbar-brand" href="home.ejs"> <img src="/singlepage/assets/img/logo.png" class="logo-img" alt="logo">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="menu_icon"><i class="fas fa-bars"></i></span>
            </button>

            <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="/home">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="about">about</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/fullproducts">Products</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="contact">Contact</a>
                </li>
              </ul>
            </div>

            <div class="hearer_icon d-flex align-items-center">
              <!-- Other icons... -->

              <% if (locals.userData && locals.userData.blockStatus===false) { %>
                <a href="/addwishlist" class="wishlist-link">
                  <i class="fas fa-heart"></i>
                  <span class="wishlist-count"></span>
                </a>

                <a href="/addtocart">
                  <i class="flaticon-shopping-cart-black-shape"></i>
                </a>
                <a href="/profile">
                  <img src="/img/285645_user_icon.png" height="25px" width="25px" style="margin-left:20px;" alt="">
                </a>

                <a href="/logout">
                  <i class="logout-icon">&#128075;</i>
                </a>

                <% }else { %>

                  <a href="/login">
                    <i class="login-icon">&#128274;</i>
                  </a>
                  <% } %>


            </div>
          </nav>
        </div>
      </div>
    </div>
    <!-- Search input code... -->
  </header>
  <!-- Header part end-->

  <!--  breadcrumb part start-->
  <section class="breadcrumb_part">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="breadcrumb_iner">
            <h2>Products:<%= category %>
            </h2>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb part end -->

  <!-- product list part start-->
  <section class="product_list section_padding">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <div class="product_sidebar">
            <div class="single_sedebar">
              <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Search product name" name="search" value="<%= search %>">
                <button class="btn btn-outline-success" type="submit">Search</button>
              </form>
            </div>
            <div class="single_sedebar">
              <div class="select_option">
                <div class="select_option_list">Category <i class="right fas fa-caret-down"></i> </div>
                <div class="select_option_dropdown">
                  <% categories.forEach(function(x,i) { %>
                      <p><a href="/fullproducts?category=<%= x.categoryName %>&search=<%= search %>&sort=<% sort %>"><%= x.categoryName %></a></p>
                    <% }) %>
                </div>
              </div>
            </div>
            <div class="single_sedebar">
              <div class="select_option">
                <div class="select_option_list">Sort <i class="right fas fa-caret-down"></i> </div>
                <div class="select_option_dropdown">
                  <p><a href="/fullproducts?search=<%= search %>&category=<%= category %>&sort=price_low">Price: Low to High</a></p>
                  <p><a href="/fullproducts?search=<%= search %>&category=<%= category %>&sort=price_high">Price: High to Low</a></p>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="col-md-8">
          <div class="product_list">
            <div class="row">
              <% products.forEach(function(product,i) { %>
                <% if (!product.isDisabled) { %>
                  <div class="col-lg-6 col-sm-6">
                    <div class="single_product_item border" style="border-radius: 10px;">
                      <img src="<%= products[i].imageUrls[0].url %>" alt="#" class="img-fluid">
                      <h3 class="text-center">
                        <a href="/single-product/<%= products[i]._id %>" style="text-decoration: none;">
                          <%= products[i].productName %>
                        </a>
                      </h3>
                      <div class="row">
                        <div class="col-6">
                          <p class="text-center">
                            Rs. <%= products[i].price %>
                          </p>
                        </div>
                        <div class="col-6">
                          <% if(products[i].price < products[i].offerPrice) { %>
                            <p class="text-center">
                              <%=products[i].offerPercentage %> % Off <del>Rs. <%= products[i].offerPrice %></del>
                            </p>
                            <% } %>
                        </div>
                      </div>
                      <% if (product.stockCount==0) { %>
                        <h3 style="color: red;">Out of Stock</h3>
                        <% } else { %>
                          <div class="card_area d-flex justify-content-between m-3 ">
                            <button type="button" class="btn " onclick="addToCart('<%= products[i]._id %>')"
                              style="background-color: #f4edf2; color: black;">Add to Cart</button>
                            <button type="button" class="btn " onclick="addToWishlist('<%= products[i]._id %>')"
                              style="background-color: #f4edf2; color: black;">Add to Wishlist</button>
                          </div>
                          <% } %>
                    </div>
                  </div>
                  <% } %>
                    <% }); %>
            </div>

            <% let previous=currentPage - 1; %>
              <% let next=currentPage + 1; %>
                <% if (currentPage> 1) { %>
                  <a
                    href="?page=<%= previous %>&search=<%= search %>&category=<%= category %>&sort=<%= sort %>">Previous</a>
                  <% } %>

                    <% for (let j=1; j <=totalPages; j++) { %>
                      <% if (search && category && sort) { %>
                        <a href="?page=<%= j %>&search=<%= search %>&category=<%= category %>&sort=<%= sort %>">
                          <% } else if (search && category) { %>
                            <a href="?page=<%= j %>&search=<%= search %>&category=<%= category %>">
                              <% } else if (search && sort) { %>
                                <a href="?page=<%= j %>&search=<%= search %>&sort=<%= sort %>">
                                  <% } else if (category && sort) { %>
                                    <a href="?page=<%= j %>&category=<%= category %>&sort=<%= sort %>">
                                      <% } else if (category) { %>
                                        <a href="?page=<%= j %>&category=<%= category %>">
                                          <% } else if (search) { %>
                                            <a href="?page=<%= j %>&search=<%= search %>">
                                              <% } else if (sort) { %>
                                                <a href="?page=<%= j %>&sort=<%= sort %>">
                                                  <% } else { %>
                                                    <a href="?page=<%= j %>">
                                                      <% } %>
                                                        <%= j %>
                                                    </a>
                                                    <% } %>

                                                      <% if (currentPage < totalPages) { %>
                                                        <a
                                                          href="?page=<%= next %>&search=<%= search %>&category=<%= category %>&sort=<%= sort %>">Next</a>
                                                        <% } %>

                                                          <br><br>


          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- product list part end-->




  <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">

            <% carousels.forEach(function(carousel, i) {
                if (!carousel.isDisabled) {
                    carousel.carouselImages.forEach(function(carouselImage, j) {
                        var isActive = (j === 0) ? 'active' : ''; // Add 'active' class to the first item only
    
                        %>
        <div class="carousel-item <%= isActive %>">
          <img class="d-block w-100" src="/admin/<%= carouselImage %>">
        </div>
        <% }); } }); %>
    </div>

    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>



  <!--::footer_part start::-->
  <footer class="footer_part">
    <div class="footer_iner">
      <div class="container">
        <div class="row justify-content-between align-items-center">
          <div class="col-lg-8">
            <div class="footer_menu">
              <div class="footer_logo">
                <a href="index.html"><img src="/img/logo.png" class="logo-img" alt="#"></a>
              </div>
              <div class="footer_menu_item">
                <a href="/home">Home</a>
                <a href="about.html">About</a>
                <a href="/fullproducts">Products</a>                
                <a href="contact.html">Contact</a>
              </div>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="social_icon">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-google-plus-g"></i></a>
              <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!--::footer_part end::-->

  <!-- jquery plugins here-->
  <script src="/js/jquery-1.12.1.min.js"></script>
  <!-- popper js -->
  <script src="/js/popper.min.js"></script>
  <!-- bootstrap js -->
  <script src="/js/bootstrap.min.js"></script>
  <!-- easing js -->
  <script src="/js/jquery.magnific-popup.js"></script>
  <!-- swiper js -->
  <script src="/js/swiper.min.js"></script>
  <!-- swiper js -->
  <script src="/js/mixitup.min.js"></script>
  <!-- particles js -->
  <script src="/js/owl.carousel.min.js"></script>
  <script src="/js/jquery.nice-select.min.js"></script>
  <!-- slick js -->
  <script src="/js/slick.min.js"></script>
  <script src="/js/jquery.counterup.min.js"></script>
  <script src="/js/waypoints.min.js"></script>
  <script src="/js/contact.js"></script>
  <script src="/js/jquery.ajaxchimp.min.js"></script>
  <script src="/js/jquery.form.js"></script>
  <script src="/js/jquery.validate.min.js"></script>
  <script src="/js/mail-script.js"></script>
  <!-- custom js -->
  <script src="/js/custom.js"></script>

  <script>
    const addToCart = async (productId) => {
      try {
        const response = await fetch('/addtocart', {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ productId: productId })
        });
        const res = await response.json();

        if (res === "success") {
          Swal.fire({
            title: 'Success',
            text: "Item added to Cart!",
            icon: 'success',
            showConfirmButton: true,
            iconHtml: '<i class="fas fa-shopping-cart"></i>',
            timer: 1000
          });
        } else if (res === "Iteminside") {
          Swal.fire({
            title: 'Success',
            text: "Item already inside the Cart, please click the cart Icon!",
            icon: 'error',
            showConfirmButton: true,
            iconHtml: '<i class="fas fa-shopping-cart"></i>',
            timer: 1000
          });
        }
        else if (res === "usernotloggedin") {
          Swal.fire({
            title: 'Login',
            text: "Please login to add the item to the cart!",
            icon: 'error',
            showConfirmButton: false,
            iconHtml: '<i class="fas fa-shopping-cart"></i>',
            timer: 1000
          });
        }
        else if (res === "userblocked") {
          console.log(res);
          window.location.href = '/logout'
        }
        else {
          Swal.fire({
            title: 'Error',
            text: "An error occurred while adding the item to the cart!",
            icon: 'error',
            showConfirmButton: false,
            iconHtml: '<i class="fas fa-shopping-cart"></i>',
            timer: 1000
          });
        }
      } catch (error) {
        console.log(error);
        Swal.fire({
          title: 'Error',
          text: "An error occurred while adding the item to the cart!",
          icon: 'error',
          showConfirmButton: false,
          iconHtml: '<i class="fas fa-shopping-cart"></i>',
          timer: 1000
        });
      }
    };


    const addToWishlist = async (productId) => {
      // console.log("==========productId=========",productId);
      const response = await fetch('/addwishlist', {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ productId: productId })
      });
      // console.log(response);
      const res = await response.json();
      // console.log(res,"-----------------res-------------");
      if (res === 'success') {
        // const data = await response.json();
        // console.log(data,"------------------data----------------");
        Swal.fire({
          title: 'Success',
          text: "Item added to wishlist !",
          icon: 'success',
          showConfirmButton: false,
          iconHtml: '<i class="fas fa-heart"></i>',
          timer: 1000
        });
        const wishlistContainer = document.getElementById('wishlist-container');
        const itemElement = document.createElement("div");
        wishlistContainer.appendChild(itemElement);
      }
      else if (res === 'Productexists') {
        Swal.fire({
          title: 'Success',
          text: "Item already added to wishlist, check in the wishlist table!",
          icon: 'success',
          showConfirmButton: false,
          iconHtml: '<i class="fas fa-heart"></i>',
          timer: 3000
        });
      }
      else if (res === "usernotloggedin") {
        Swal.fire({
          title: 'Login',
          text: "Please login to add the item to the wishlist!",
          icon: 'error',
          showConfirmButton: false,
          iconHtml: '<i class="fas fa-heart"></i>',
          timer: 1000
        });
      }
      else if (res === "userblocked") {
        console.log(res);
        Swal.fire({
          title: 'Blocked',
          text: "Contact the admin:'jesvinjose49@gmail.com' to add the item to the wishlist, user is blocked!",
          icon: 'error',
          showConfirmButton: false,
          iconHtml: '<i class="fas fa-heart"></i>',
          timer: 1000
        });
      }
      else {
        res.status(500).json({ message: "Error adding product to wishlist!" });
      }
    }  
  </script>

</body>

</html>